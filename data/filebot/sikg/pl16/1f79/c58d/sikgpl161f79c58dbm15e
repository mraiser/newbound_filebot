{"data":{"css":".fileinfowrap{\n  padding:20px;\n  cursor:pointer;\n}\n\n.uploadbutton{\n  clear:both;\n}\n\n.folderinfo{\n  width:1000000px;\n  max-width:100%;\n}\n\n.searchbar{\n  position:absolute;\n  top:-60px;\n  right:0px;\n}","data":[],"name":"folderinfo","js":"var me = this;\nvar ME = $('#'+me.UUID)[0];\n\nfunction mf(sel){ return $(ME).find(sel); }\n\nme.ready = function(){\n  var path = ME.DATA.path;\n  if (!path || path == '') path = '/';\n  else if (path == '/local') path = '/local/';\n  else if (path == '/remote') path = '/remote/';\n\n  if (path == '/'){\n    mf('.folderbuttons').css('display', 'none');\n    var el = $('<div class=\"fileinfowrap\" />');\n    el.click(function(){ showFolder('/local'); });\n    mf('.folderinfo').append(el);\n    var data = { path:\"/local\" };\n    installControl(el[0], 'filebot', 'filecard', function(){}, data);\n    \n    el = $('<div class=\"fileinfowrap\" />');\n    el.click(function(){ showFolder('/remote'); });\n    mf('.folderinfo').append(el);\n    data = { path:\"/remote\" };\n    installControl(el[0], 'filebot', 'filecard', function(){}, data);\n  }\n  else if (path.indexOf('/remote/') == 0) {\n    if (path == '/remote/') {\n      mf('.folderbuttons').css('display', 'none');\n      $(ME).find('.searchbar').empty();\n      json('../peerbot/connections', null, function(result){\n        for (var i in result.data){\n          var p = result.data[i];\n          if (p.connected){\n            function showRemote(data){\n              var el = $('<div class=\"fileinfowrap\" />');\n              el.click(function(){ \n                showFolder('/remote/'+data.id, data.name); \n              });\n              mf('.folderinfo').append(el);\n              installControl(el[0], 'filebot', 'filecard', function(){}, data);\n            }\n            showRemote(p);\n          }\n        }\n      });\n    }\n    else {\n      path = path.substring(8);\n      var i = path.indexOf('/');\n      var peer = i == -1 ? path : path.substring(0,i);\n      ME.DATA.peer = peer;\n      path = i == -1 ? '/' : path.substring(i);\n      if (i == -1) mf('.folderbuttons').css('display', 'none');\n      else mf('.downloadbutton').prop('href', '../peerbot/remote/'+peer+'/filebot/zipdir/archive.zip?path='+encodeURIComponent(path));\n      \n      var el = $(ME).find('.searchbar');\n      var d = {\n        \"path\": path,\n        \"peer\": peer\n      };\n      installControl(el[0], 'filebot', 'search', function(api){}, d);\n      \n      json('../peerbot/remote/'+peer+'/filebot/fileinfo', 'path='+encodeURIComponent(path)+'&children=false', function(result){\n        if (result.list.length == 0) mf('.folderinfo').html('<div style=\"width:100000px;padding:40px;\"><i>This folder is empty.<\/i><\/div>');\n        else for (var i in result.list) {\n          function showRemote(data){\n              var el = $('<div class=\"fileinfowrap\" />');\n              el.click(function(){ \n                if (data.directory) showFolder('/remote/'+peer+data.path); \n      //          else showFile('/local'+data.path); \n              });\n              mf('.folderinfo').append(el);\n              data.peer = peer;\n              installControl(el[0], 'filebot', 'filecard', function(){}, data);\n          }\n          \n          var f = result.list[i];\n          if (typeof f == 'object') showRemote(f);\n          else {\n            var newpath = path + (path.endsWith('/') ? f : '/'+f);\n            json('../peerbot/remote/'+peer+'/filebot/fileinfo', 'path='+encodeURIComponent(newpath)+'&children=false', function(data){\n              showRemote(data);\n            });\n          }\n          \n        }\n      });\n    }\n    \n  }\n  else if (path.indexOf('/local/') == 0) {\n    var el = $(ME).find('.searchbar');\n    if (path == '/local/') {\n      mf('.folderbuttons').css('display', 'none');\n      el.empty();\n    }\n    else {\n      mf('.folderbuttons').css('display', 'inline-block');\n      var d = {\n        \"path\": path.substring(6)\n      };\n      installControl(el[0], 'filebot', 'search', function(api){}, d);\n    }\n    \n    mf('.downloadbutton').prop('href', '../filebot/zipdir/archive.zip?path='+encodeURIComponent(ME.DATA.path.substring(6)));\n\n    function showLocal(data){\n        var el = $('<div class=\"fileinfowrap\" />');\n        el.click(function(){ \n          if (data.directory) showFolder('/local'+data.path); \n//          else showFile('/local'+data.path); \n        });\n        mf('.folderinfo').append(el);\n        installControl(el[0], 'filebot', 'filecard', function(){}, data);\n    }\n    \n    json('../filebot/fileinfo', 'path='+encodeURIComponent(path.substring(6))+'&children=false', function(result){\n      if (result.list.length == 0) mf('.folderinfo').html('<div style=\"width:100000px;padding:40px;\"><i>This folder is empty.<\/i><\/div>');\n      else for (var i in result.list) {\n        var f = result.list[i];\n        if (typeof f == 'object') showLocal(f);\n        else {\n          var newpath = path.substring(6) + (path.endsWith('/') ? f : '/'+f);\n          json('../filebot/fileinfo', 'path='+encodeURIComponent(newpath)+'&children=false', function(data){\n            showLocal(data);\n          });\n        }\n      }\n    });\n  }\n  else {\n    json('../filebot/fileinfo', 'path='+encodeURIComponent(path)+'&children=false', function(result){\n      $(ME).find('.folderinfo').text(JSON.stringify(result));\n    });\n  }  \n};\n\n$(ME).find('.deletebutton').click(function(){\n  installControl(mf('.popupdiv')[0], 'metabot', 'confirmdialog', function(){}, {\n    title: 'Delete Folder',\n    text: 'Are you sure you want to delete this folder and all of its contents? This cannot be undone.',\n    cb: function(name){\n      if (ME.DATA.peer) {\n        var path = ME.DATA.path.substring(8+ME.DATA.peer.length);\n        \n\t\tjson('../peerbot/remote/'+ME.DATA.peer+'/filebot/deletefolder','path='+encodeURIComponent(path)+'&name='+encodeURIComponent(name)+'&peer=local', function(){\n\t\t\tshowFolder(ME.DATA.path.substring(0,ME.DATA.path.lastIndexOf('/')));\n\t\t});\n      }\n      else {\n\t\tjson('../filebot/deletefolder','path='+encodeURIComponent(ME.DATA.path.substring(6))+'&peer=local', function(){\n\t\t\tshowFolder(ME.DATA.path.substring(0,ME.DATA.path.lastIndexOf('/')));\n\t\t});\n      }\n    }\n  });\n});\n\n$(ME).find('.newbutton').click(function(){\n  installControl(mf('.popupdiv')[0], 'metabot', 'promptdialog', function(){}, {\n    title: 'New Folder',\n    text: 'Folder Name',\n    cb: function(name){\n\n      if (ME.DATA.peer) {\n        var path = ME.DATA.path.substring(8+ME.DATA.peer.length);\n        \n\t\tjson('../peerbot/remote/'+ME.DATA.peer+'/filebot/newfolder','path='+encodeURIComponent(path)+'&name='+encodeURIComponent(name)+'&peer=local', function(){\n\t        showFolder(ME.DATA.path);\n\t\t});\n      }\n      else {\n\t\tjson('../filebot/newfolder','path='+encodeURIComponent(ME.DATA.path.substring(6))+'&name='+encodeURIComponent(name)+'&peer=local', function(){\n\t        showFolder(ME.DATA.path);\n\t\t});\n      }\n      \n    }\n  });\n});\n\n\n$(ME).find('.uploadbutton').click(function(){\n  var path = ME.DATA.peer ? ME.DATA.path.substring(8+ME.DATA.peer.length) : ME.DATA.path.substring(6);  \n  installControl(mf('.popupdiv')[0], 'filebot', 'uploaddialog', function(){}, {\n    peer: ME.DATA.peer,\n    path: path,\n    cb: function(val){\n      showFolder(ME.DATA.path);\n    }\n  });\n});","groups":"anonymous","ctl":"sikgpl161f79c58dbm15e","html":"<div class='flex folderinfo'><\/div>\n<br>\n<div class='flex'>\n  <a class=\"mdl-button mdl-js-button mdl-button--fab mdl-button--colored folderbuttons downloadbutton\" download=\"archive.zip\">\n    <i class=\"material-icons\">get_app<\/i>\n  <\/a>\n  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;\n  <button class=\"mdl-button mdl-js-button mdl-button--fab mdl-button--colored folderbuttons newbutton\">\n    <i class=\"material-icons\">add<\/i>\n  <\/button>\n  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;\n  <button class=\"mdl-button mdl-js-button mdl-button--fab mdl-button--colored folderbuttons uploadbutton\">\n    <i class=\"material-icons\">publish<\/i>\n  <\/button>\n  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;\n  <button class=\"mdl-button mdl-js-button mdl-button--fab folderbuttons deletebutton\">\n    <i class=\"material-icons\">delete<\/i>\n  <\/button>\n  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;\n<\/div>\n<div class='searchbar'><\/div>\n\n<div class='popupdiv'><\/div>","cmd":[{"java":"sohisz161fc74c031l191","name":"move","id":"hhlzhi161fc74c034z192"}],"three":{"controls":[],"assets":[],"behaviors":[],"animations":[],"poses":[]},"db":"filebot","desc":""},"readers":["anonymous"],"id":"sikgpl161f79c58dbm15e","sessionid":"jvgvwg16b7a4d277bt3","time":1637510706263,"addr":"/0:0:0:0:0:0:0:1:42208","username":"admin"}
{"data":{"css":".powerheader .mdl-layout__drawer-button {\n  padding-top: 12px;\n  height: 40px;\n}\n\n.powerheader a {\n  text-decoration:none;\n  color: rgb(66,66,66);\n}\n\n.filebotbg{\n  background-color:white;\n}\n\n.mdl-button--fab.mdl-button--colored{\n  background-color:#83bc00;\n} \n\n.mdl-button--fab.mdl-button--colored:hover{\n  background-color:#b7ef49;\n}\n\n.menubutton {\n  position:absolute;\n  left:20px;\n  cursor:pointer;\n  border-bottom:none;\n}\n\n.page-content{\n  padding:20px;\n}\n\n.restofthesettings{\n  display:none;\n}\n\n.note{\n  font-style: italic;\n  margin-bottom: 20px;\n}\n\n.pad20{\n  padding: 20px;\n}\n\n.raise20{\n  margin-top:-20px;\n}\n\n.refreshindex{\n  margin-left:20px;\n}\n\n.hideme{\n  display:none;\n}\n\n.sharetable, .searchindex, .excludetable{\n  margin-top:20px;\n}","data":[],"name":"search_settings","js":"var me = this;\nvar ME = $('#'+me.UUID)[0];\n\nme.ready = function(){\n  componentHandler.upgradeAllRegistered();\n  \n  send_getindexsettings(function(result){\n    console.log(result);\n    if (result.data.searchindex){\n      var el = $(ME).find('.searchindex');\n      el.find('input').prop('checked', true);\n      el[0].MaterialSwitch.checkToggleState();\n      $(ME).find('.restofthesettings').css('display', 'block');\n      \n      if (result.data.indexcontent){\n        el = $(ME).find('.indexcontent');\n        el.find('input').prop('checked', true);\n        el[0].MaterialSwitch.checkToggleState();\n        \n        el = $(ME).find('.indexworkdir');\n        el.find('input').val(result.data.indexworkdir);\n        el[0].MaterialTextfield.checkDirty();\n      }\n    }\n    \n    json('../filebot/fileinfo', 'path=/&children=true', function(result){\n      me.shares = result.list;\n      buildShares();\n      send_getexcludes(function(result){\n        me.excludes = result.data.list;\n        buildExcludes();\n      });\n    });\n\n  });\n};\n\n$(ME).find('.saveindexsettings').click(function(){\n  var searchindex = $(ME).find('.searchindex').find('input').prop('checked');\n  var indexcontent = $(ME).find('.indexcontent').find('input').prop('checked');\n  var indexworkdir = $(ME).find('.indexworkdir').find('input').val();\n  send_saveindexsettings(searchindex, indexcontent, indexworkdir, function(result){\n    if (result.status != 'ok') alert(result.msg);\n    else{\n      var settings = '';\n      $(ME).find('.sharetable').find('tr').each(function(x,y){\n        var vals = $(y).find('input');\n        if (vals[1]){\n          var name = vals[0].value;\n          var path = vals[1].value;\n          if (name != ''){\n            if (settings != '') settings += '\\r';\n            settings += name+'\\t'+path;\n          }\n        }\n      });\n      var list = [];\n      $(ME).find('.excludetable').find('tr').each(function(x,y){\n        var vals = $(y).find('input');\n        if (vals[0]){\n          var path = vals[0].value;\n          if (path != '') list.push(path);\n        }\n      });\n      send_setexcludes(list, function(result){\n        if (result.status != 'ok') alert(result.msg);\n        else {\n          json(\"../filebot/updatefileshare\",\"v=\"+encodeURIComponent(settings), function(result){\n            console.log(result);\n            if (result.status != 'ok') alert(result.msg);\n            else {\n              document.location.href = '../filebot/index.html';\n            }\n          });\n        }\n      });\n    }\n  });\n});\n\n$(ME).find('.addsharebutton').click(function(){\n  me.shares.push({name:'',realpath:''});\n  buildShares();\n});\n\n$(ME).find('.addexcludebutton').click(function(){\n  me.excludes.push('');\n  buildExcludes();\n});\n\n$(ME).find('.searchindex').find('input').change(function(){\n  $(ME).find('.restofthesettings').css('display', $(this).prop('checked') ? 'block' : 'none');\n});\n\nfunction buildExcludes(){\n  if (me.excludes.length == 0) $(ME).find('.addexcludebutton').click();\n  var newhtml = '<table class=\"mdl-data-table mdl-js-data-table mdl-shadow--2dp\"><thead><tr><th class=\"mdl-data-table__cell--non-numeric\">Delete<\/th><th class=\"mdl-data-table__cell--non-numeric\">Path<\/th><\/tr><\/thead><tbody class=\"addshareshere\">';\n  for (var item in me.excludes){\n    var rli = me.excludes[item];\n    newhtml += buildExclude(rli);\n  }\n  newhtml += '<\/tbody><\/table>';\n  var el = $(ME).find('.excludetable');\n  el.html(newhtml);\n  el.find('.deletesetting').click(function(e){\n    var rli = $(this).closest('tr').find('input')[0].value;\n    me.excludes.splice(me.excludes.indexOf(rli), 1);\n    buildExcludes();\n  });;  \n  componentHandler.upgradeAllRegistered();\n}\n\nfunction buildExclude(rli){\n  var id1 = guid();\n  return '<tr><td class=\"mdl-data-table__cell--non-numeric\"><button class=\"mdl-button mdl-button--icon mdl-js-button mdl-js-ripple-effect deletesetting\"><i class=\"material-icons\">delete<\/i><\/button><\/td><td class=\"mdl-data-table__cell--non-numeric\">'\n    + '<form action=\"#\"><div class=\"mdl-textfield mdl-js-textfield\"><input class=\"mdl-textfield__input\" type=\"text\" id=\"'\n    + id1\n    + '\" value=\"'\n    + rli\n    +'\"><label class=\"mdl-textfield__label\" for=\"'\n    + id1\n    + '\">Path to exclude<\/label><\/div>'\n    + '<\/form>'\n    + '<\/td><\/tr>';\n}\n\nfunction buildShares(){\n  if (me.shares.length == 0) $(ME).find('.addsharebutton').click();\n  var newhtml = '<table class=\"mdl-data-table mdl-js-data-table mdl-shadow--2dp\"><thead><tr><th class=\"mdl-data-table__cell--non-numeric\">Delete<\/th><th class=\"mdl-data-table__cell--non-numeric\">Index<\/th><th class=\"mdl-data-table__cell--non-numeric\">Name<\/th><th class=\"mdl-data-table__cell--non-numeric\">Path<\/th><\/tr><\/thead><tbody class=\"addshareshere\">';\n  for (var item in me.shares){\n    var rli = me.shares[item];\n    newhtml += buildShare(rli);\n  }\n  newhtml += '<\/tbody><\/table>';\n  var el = $(ME).find('.sharetable');\n  el.html(newhtml);\n  el.find('.deletesetting').click(function(e){\n    var path = $(this).closest('tr').find('input')[1].value;\n    var rli = getByProperty(me.shares, 'realpath', path);\n    me.shares.splice(me.shares.indexOf(rli), 1);\n    buildShares();\n  });;\n  el.find('.refreshindex').click(function(e){\n    var el = $(this).closest('tr');\n    var name = el.find('input')[0].value;\n    el.find('.lastindexdate').html('in progress');\n    json('../filebot/index', 'path=/'+name, function(result){\n      el.find('.lastindexdate').html(result.status == 'ok' ? 'just now' : \"Error: \"+result.msg);\n    });\n  });;\n  componentHandler.upgradeAllRegistered();\n}\n\nfunction buildShare(rli){\n  var id1 = rli.id1 = guid();\n  var id2 = rli.id2 = guid();\n  return '<tr><td class=\"mdl-data-table__cell--non-numeric\"><button class=\"mdl-button mdl-button--icon mdl-js-button mdl-js-ripple-effect deletesetting\"><i class=\"material-icons\">delete<\/i><\/button><\/td><td class=\"mdl-data-table__cell--non-numeric\"><button class=\"mdl-button mdl-button--icon mdl-js-button mdl-js-ripple-effect refreshindex\"><i class=\"material-icons\">refresh<\/i><\/button><\/td><td class=\"mdl-data-table__cell--non-numeric\">'\n    + '<form action=\"#\"><div class=\"mdl-textfield mdl-js-textfield sharename\"><input class=\"mdl-textfield__input\" type=\"text\" id=\"'\n    + id1\n    + '\" value=\"'\n    + rli.name\n    +'\"><label class=\"mdl-textfield__label\" for=\"'\n    + id1\n    + '\">Share Name<\/label><\/div>'\n    + '<div style=\"text-align:right;\">Last index:<\/div><\/form>'\n    + '<\/td><td class=\"mdl-data-table__cell--non-numeric\">'\n    + '<form action=\"#\"><div class=\"mdl-textfield mdl-js-textfield\"><input class=\"mdl-textfield__input\" type=\"text\" id=\"'\n    + id2\n    + '\" value=\"'\n    + rli.realpath\n    +'\"><label class=\"mdl-textfield__label\" for=\"'\n    + id2\n    + '\">Path to share<\/label><\/div>'\n    + '<div><i class=\"lastindexdate\">'+(rli.lastindex == -1 || typeof rli.lastindex == 'undefined' ? 'never' : parseDate(new Date(rli.lastindex)))+'<\/i><\/div><\/form>'\n    + '<\/td><\/tr>';\n}\n\n$(ME).find('.deleteindex').click(function(){\n  var data = {\n    title:'Delete Index',\n    text:'Are you sure you want to delete your search index? This will completely erase the contents of '+$(ME).find('.indexworkdir').find('input').val()+' on disk. This cannot be undone.',\n    cancel:'cancel',\n    ok:'delete',\n    cb: function(){\n      send_deleteindexes(function(result){\n        alert(result.msg);\n        setTimeout(buildShares, 3000);\n      });\n    }\n  };\n  installControl($(ME).find('.dialogdiv')[0], 'metabot', 'confirmdialog', function(){}, data);\n});\n\n$(ME).find('.refreshindex').click(function(){\n  var list = [];\n  for (var item in me.shares){\n    var rli = me.shares[item];\n    list.push(rli);\n    var el = $('#'+rli.id2).closest('td');\n    el.find('.lastindexdate').html('in progress');\n  }\n  function popNext(){\n    if (list.length>0){\n      var rli = list.pop();\n      var name = rli.name;\n      json('../filebot/index', 'path=/'+name, function(result){\n        var el = $('#'+rli.id2).closest('td');\n        el.find('.lastindexdate').html(result.status == 'ok' ? 'just now' : \"Error: \"+result.msg);\n        popNext();\n      });\n    }\n    else alert('INDEX DONE');\n  }\n  popNext();\n});\n\n$(document).click(function(event) {\n   window.lastElementClicked = event.target;\n});\n","groups":"","ctl":"kzrkth17d3de732cbq22","html":"<div class=\"mdl-layout mdl-js-layout mdl-layout--fixed-header\">  \n  <header class=\"mdl-layout__header powerheader\">\n    <div aria-expanded=\"false\" role=\"button\" tabindex=\"0\" class=\"mdl-layout__drawer-button\"><a class=\"material-icons backbutton\" href='../filebot/index.html'>chevron_left<\/a><\/div>\n    <div class=\"mdl-layout__header-row\">\n      <span class=\"mdl-layout-title\">Filebot Settings<\/span>\n      <div class=\"mdl-layout-spacer\"><\/div>\n    <\/div>\n  <\/header>\n  <main class=\"mdl-layout__content filebotbg\">\n    <div class=\"page-content\">\n      <h2 class=\"mdl-card__title-text\">Shared Files<\/h2>\n      <div class='sharetable'><\/div>\n      <br>\n      <button class=\"mdl-button mdl-js-button mdl-button--fab mdl-js-ripple-effect mdl-button--colored addsharebutton\">\n        <i class=\"material-icons\">add<\/i>\n      <\/button>\n      <hr/>\n      <h2 class=\"mdl-card__title-text\">Search<\/h2>\n      <label class=\"mdl-switch mdl-js-switch mdl-js-ripple-effect searchindex\" for=\"searchindex\">\n        <input type=\"checkbox\" id=\"searchindex\" class=\"mdl-switch__input\">\n        <span class=\"mdl-switch__label\">Enable Search<\/span>\n      <\/label>  \n      <div class='restofthesettings'>\n        <label class=\"mdl-switch mdl-js-switch mdl-js-ripple-effect indexcontent\" for=\"indexcontent\">\n          <input type=\"checkbox\" id=\"indexcontent\" class=\"mdl-switch__input\">\n          <span class=\"mdl-switch__label\">Search Content<\/span>\n        <\/label>  \n        <form action=\"#\">\n          <div class=\"mdl-textfield mdl-js-textfield mdl-textfield--floating-label indexworkdir\">\n            <input class=\"mdl-textfield__input\" type=\"text\" id=\"indexworkdir\">\n            <label class=\"mdl-textfield__label\" for=\"indexworkdir\">Working Directory<\/label>\n          <\/div>\n        <\/form>\n        <div class='pad20 raise20'>\n          <div class='note'>\n            NOTE: If you change any of these settings you should first delete the existing index, then save the new settings, and finally refresh the index.\n          <\/div>\n          <button class=\"mdl-button mdl-js-button mdl-button--raised mdl-js-ripple-effect deleteindex\">\n            Delete Index\n          <\/button>\n          <button class=\"mdl-button mdl-js-button mdl-button--raised mdl-js-ripple-effect refreshindex\">\n            Refresh Index\n          <\/button>\n        <\/div>\n        <hr/>\n        <h2 class=\"mdl-card__title-text\">Exclude Directories From Search Index Refresh<\/h2>\n        <div class='excludetable'><\/div>\n        <br>\n        <button class=\"mdl-button mdl-js-button mdl-button--fab mdl-js-ripple-effect mdl-button--colored addexcludebutton\">\n          <i class=\"material-icons\">add<\/i>\n        <\/button>\n      <\/div>  \n      <hr/>\n      <button class=\"mdl-button mdl-js-button mdl-button--raised mdl-js-ripple-effect mdl-button--colored saveindexsettings\">\n        Save Settings\n      <\/button>\n    <\/div>\n  <\/main>\n<\/div>\n<div class='dialogdiv'><\/div>","cmd":[{"java":"kvtjxv17d3df76a20v23","name":"getindexsettings","id":"nkohpi17d3df76a24u24"},{"java":"zmsrwo17d3e3e2e8bi2a","name":"saveindexsettings","id":"lwwunz17d3e3e2e8fu2b"},{"java":"ppowgs17d3e6d74b8v32","name":"getexcludes","id":"mohunr17d3e6d74bbx33"},{"java":"tyopqp17d3e8512f9h3a","name":"setexcludes","id":"wqoyvp17d3e8512fcg3b"},{"java":"iyuhzk17d4307979dg2e","name":"deleteindexes","id":"logzzu17d430797a2h2f"}],"three":{"controls":[],"assets":[],"behaviors":[],"animations":[],"poses":[]},"db":"filebot","desc":""},"id":"kzrkth17d3de732cbq22","sessionid":"jvgvwg16b7a4d277bt3","time":1637509455415,"addr":"/0:0:0:0:0:0:0:1:41780","username":"admin"}